<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SV Gutachten Schwei√ütechnik v10.1 Premium Edition</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/docx@8.5.0/build/index.umd.js"></script>
  <script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:linear-gradient(135deg,#0f172a 0%,#1e293b 50%,#0f172a 100%);min-height:100vh;color:#e2e8f0}
    
    /* Glassmorphism Cards */
    .glass{background:rgba(255,255,255,0.05);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.1);border-radius:16px}
    .glass-dark{background:rgba(0,0,0,0.3);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.08);border-radius:16px}
    
    /* Animations */
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
    @keyframes spin{to{transform:rotate(360deg)}}
    @keyframes gradient{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    @keyframes glow{0%,100%{box-shadow:0 0 20px rgba(249,115,22,0.3)}50%{box-shadow:0 0 40px rgba(249,115,22,0.6)}}
    @keyframes slideIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
    
    .loading{display:inline-block;width:20px;height:20px;border:2px solid rgba(255,255,255,0.3);border-top-color:#fff;border-radius:50%;animation:spin .8s linear infinite}
    .animate-slide{animation:slideIn 0.5s ease-out}
    .animate-float{animation:float 3s ease-in-out infinite}
    .animate-glow{animation:glow 2s ease-in-out infinite}
    
    /* Premium Button */
    .btn-premium{background:linear-gradient(135deg,#f97316,#ea580c,#c2410c);background-size:200% 200%;animation:gradient 3s ease infinite;border:none;color:#fff;font-weight:600;cursor:pointer;transition:all 0.3s ease;box-shadow:0 4px 15px rgba(249,115,22,0.4)}
    .btn-premium:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(249,115,22,0.5)}
    .btn-premium:disabled{opacity:0.5;cursor:not-allowed;transform:none}
    
    .btn-notion{background:linear-gradient(135deg,#000,#1a1a2e);border:1px solid rgba(255,255,255,0.2)}
    .btn-notion:hover{background:linear-gradient(135deg,#1a1a2e,#16213e)}
    
    /* Grid System */
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:24px}
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    .grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
    @media(max-width:1024px){.grid-2{grid-template-columns:1fr}.grid-4{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:768px){.grid-3,.grid-4{grid-template-columns:1fr}}
    
    /* Status Colors */
    .status-bestanden{background:linear-gradient(135deg,rgba(34,197,94,0.2),rgba(22,163,74,0.1));border:1px solid rgba(34,197,94,0.5);color:#4ade80}
    .status-nacharbeit{background:linear-gradient(135deg,rgba(245,158,11,0.2),rgba(217,119,6,0.1));border:1px solid rgba(245,158,11,0.5);color:#fbbf24}
    .status-nichtbestanden{background:linear-gradient(135deg,rgba(239,68,68,0.2),rgba(220,38,38,0.1));border:1px solid rgba(239,68,68,0.5);color:#f87171}
    
    /* Scrollbar */
    ::-webkit-scrollbar{width:8px;height:8px}
    ::-webkit-scrollbar-track{background:rgba(255,255,255,0.05);border-radius:4px}
    ::-webkit-scrollbar-thumb{background:rgba(249,115,22,0.5);border-radius:4px}
    ::-webkit-scrollbar-thumb:hover{background:rgba(249,115,22,0.7)}
    
    /* Input Styles */
    input,select,textarea{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);color:#e2e8f0;border-radius:8px;padding:10px 12px;transition:all 0.3s ease}
    input:focus,select:focus,textarea:focus{outline:none;border-color:#f97316;box-shadow:0 0 0 3px rgba(249,115,22,0.2)}
    input::placeholder{color:rgba(255,255,255,0.4)}
    select option{background:#1e293b;color:#e2e8f0}
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useRef}=React;

const GRENZWERTE={haerte:{"1.1":{max:380},"1.2":{max:380},"2":{max:450},"3":{max:450},"8.1":{max:null},"10":{max:350}},zugfestigkeit:{"S235":{min:360},"S275":{min:410},"S355":{min:470},"S355J2+N":{min:470},"S460":{min:540},"S690":{min:770},"1.4301":{min:520},"1.4571":{min:520},"1.4462":{min:640}},biegeversuch:{standardWinkel:180,maxRisslaenge:3}};
const WERKSTOFFGRUPPEN={"S235":"1.1","S275":"1.1","S355":"1.2","S355J2+N":"1.2","S460":"2","S690":"3","1.4301":"8.1","1.4571":"8.1","1.4462":"10"};
const FEHLERKATALOG={"100":{name:"Riss",kritisch:true},"104":{name:"Kraterriss",kritisch:true},"2011":{name:"Pore",kritisch:false},"401":{name:"Bindefehler",kritisch:true},"402":{name:"Einbrandfehler",kritisch:true},"502":{name:"Naht√ºberh√∂hung",kritisch:false},"507":{name:"Schwei√üspritzer",kritisch:false},"5011":{name:"Einbrandkerbe",kritisch:false},"5012":{name:"Wurzelkerbe",kritisch:false},"601":{name:"Z√ºndstelle",kritisch:true}};

const getWerkstoffgruppe=w=>WERKSTOFFGRUPPEN[w]||WERKSTOFFGRUPPEN[w?.split(" ")[0]]||"1.2";
const bewerteHaerte=(w,m)=>{if(!m)return{status:"nicht gepr√ºft",text:"Keine Messwerte"};const g=getWerkstoffgruppe(w),grenz=GRENZWERTE.haerte[g];if(!grenz||grenz.max===null)return{status:"bestanden",text:m+" HV10"};const v=parseFloat(m);return v<=grenz.max?{status:"bestanden",text:v+" ‚â§ "+grenz.max+" HV10"}:{status:"nicht bestanden",text:v+" > "+grenz.max+" HV10"}};
const bewerteZugversuch=(w,m)=>{if(!m)return{status:"nicht gepr√ºft",text:"Keine Messwerte"};const grenz=GRENZWERTE.zugfestigkeit[w?.split(" ")[0]];if(!grenz)return{status:"bestanden",text:m+" N/mm¬≤"};const v=parseFloat(m);return v>=grenz.min?{status:"bestanden",text:v+" ‚â• "+grenz.min+" N/mm¬≤"}:{status:"nicht bestanden",text:v+" < "+grenz.min+" N/mm¬≤"}};
const bewerteBiegeversuch=(wi,r)=>{if(!wi&&!r)return{status:"nicht gepr√ºft",text:"Keine Messwerte"};const w=parseFloat(wi)||180,riss=parseFloat(r)||0;return(w>=180&&riss<=3)?{status:"bestanden",text:w+"¬∞, Riss "+riss+"mm"}:{status:"nicht bestanden",text:w<180?w+"¬∞ < 180¬∞":"Riss "+riss+"mm > 3mm"}};

const generateGutachtenDOCX=async(data)=>{
  if(typeof docx==='undefined'){alert('DOCX Bibliothek nicht geladen');return}
  const{Document,Paragraph,TextRun,HeadingLevel,AlignmentType,Table,TableRow,TableCell,WidthType,BorderStyle}=docx;
  const heute=new Date().toLocaleDateString('de-AT');
  const gruppe=getWerkstoffgruppe(data.werkstoff);
  const tableBorder={style:BorderStyle.SINGLE,size:1,color:"CCCCCC"};
  const cellBorders={top:tableBorder,bottom:tableBorder,left:tableBorder,right:tableBorder};
  const createCell=(text,bold=false,shading=null)=>new TableCell({children:[new Paragraph({children:[new TextRun({text:text||"-",bold,size:22})]})],width:{size:50,type:WidthType.PERCENTAGE},borders:cellBorders,shading:shading?{fill:shading}:undefined});
  const statusText=data.status==="Bestanden"?"BESTANDEN":data.status==="Nicht bestanden"?"NICHT BESTANDEN":"NACHARBEIT";
  
  const doc=new Document({
    sections:[{
      children:[
        new Paragraph({children:[new TextRun({text:"PR√úFGUTACHTEN",bold:true,size:36})],heading:HeadingLevel.HEADING_1,alignment:AlignmentType.CENTER,spacing:{after:200}}),
        new Paragraph({children:[new TextRun({text:"Schwei√ütechnische Pr√ºfung nach EN ISO 15614-1",size:24,color:"666666"})],alignment:AlignmentType.CENTER,spacing:{after:400}}),
        new Table({width:{size:100,type:WidthType.PERCENTAGE},rows:[
          new TableRow({children:[createCell("Auftragsnummer:",true,"E8E8E8"),createCell(data.auftragsnummer||"")]}),
          new TableRow({children:[createCell("Pr√ºfgegenstand:",true,"E8E8E8"),createCell(data.pruefgegenstand||"")]}),
          new TableRow({children:[createCell("Auftraggeber:",true,"E8E8E8"),createCell(data.auftraggeber||"")]}),
          new TableRow({children:[createCell("Werkstoff:",true,"E8E8E8"),createCell((data.werkstoff||"")+" (Gruppe "+gruppe+")")]}),
          new TableRow({children:[createCell("Bewertungsgruppe:",true,"E8E8E8"),createCell("ISO 5817 "+(data.bewertungsgruppe||"C"))]}),
          new TableRow({children:[createCell("Wanddicke:",true,"E8E8E8"),createCell((data.wanddicke||"-")+" mm")]}),
          new TableRow({children:[createCell("Pr√ºfdatum:",true,"E8E8E8"),createCell(heute)]})
        ]}),
        new Paragraph({text:"",spacing:{after:300}}),
        new Paragraph({children:[new TextRun({text:"ANAMNESE",bold:true,size:26,color:"1e40af"})],spacing:{before:300,after:200}}),
        new Paragraph({children:[new TextRun({text:data.anamnese||"Keine Anamnese vorhanden",size:22})],spacing:{after:300}}),
        new Paragraph({children:[new TextRun({text:"DIAGNOSE",bold:true,size:26,color:"c2410c"})],spacing:{before:300,after:200}}),
        new Paragraph({children:[new TextRun({text:data.diagnose||"Keine Diagnose vorhanden",size:22})],spacing:{after:300}}),
        new Paragraph({children:[new TextRun({text:"CONCLUSIO",bold:true,size:26,color:"166534"})],spacing:{before:300,after:200}}),
        new Paragraph({children:[new TextRun({text:data.conclusio||"Keine Conclusio vorhanden",size:22})],spacing:{after:400}}),
        new Paragraph({children:[new TextRun({text:"GESAMTERGEBNIS: ",bold:true,size:28}),new TextRun({text:statusText,bold:true,size:28,color:data.status==="Bestanden"?"166534":data.status==="Nicht bestanden"?"991b1b":"92400e"})],alignment:AlignmentType.CENTER,spacing:{before:400,after:400}}),
        new Paragraph({text:"",spacing:{after:200}}),
        new Paragraph({children:[new TextRun({text:"________________________________________"})],alignment:AlignmentType.RIGHT}),
        new Paragraph({children:[new TextRun({text:"Gerichtlich beeideter Sachverst√§ndiger",size:20,italics:true})],alignment:AlignmentType.RIGHT}),
        new Paragraph({children:[new TextRun({text:"Wien, "+heute,size:20})],alignment:AlignmentType.RIGHT})
      ]
    }]
  });
  
  const blob=await docx.Packer.toBlob(doc);
  saveAs(blob,"Gutachten_"+(data.auftragsnummer||'NEU')+"_"+heute.replace(/\./g,'-')+".docx");
};

function SchweissGutachterApp(){
  const[activeTab,setActiveTab]=useState('analyse');
  const[apiStatus,setApiStatus]=useState({anthropic:false,notion:false,cloudinary:false});
  const[selectedImages,setSelectedImages]=useState([]);
  const[imagePreviews,setImagePreviews]=useState([]);
  const[analyzing,setAnalyzing]=useState(false);
  const[saving,setSaving]=useState(false);
  const[analysisResult,setAnalysisResult]=useState(null);
  const[saveResult,setSaveResult]=useState(null);
  const fileInputRef=useRef(null);
  const[protokoll,setProtokoll]=useState({auftragsnummer:"",pruefgegenstand:"",auftraggeber:"",werkstoff:"S355",bewertungsgruppe:"C",wanddicke:"",vtErgebnis:"nicht gepr√ºft",pt:"nicht gepr√ºft",mt:"nicht gepr√ºft",ut:"nicht gepr√ºft",rt:"nicht gepr√ºft",haerteMax:"",zugfestigkeit:"",biegewinkel:"",risslaenge:"",anamnese:"",diagnose:"",conclusio:"",status:""});
  const[auftraege]=useState([{id:"1",auftragsnummer:"PA-2024-0042",pruefgegenstand:"Druckbeh√§lter DB-2024-15",auftraggeber:"M√ºller Anlagenbau",werkstoff:"S355J2+N",bewertungsgruppe:"B",status:"Bestanden",haerteMax:"285",zugfestigkeit:"520"},{id:"2",auftragsnummer:"PA-2024-0043",pruefgegenstand:"Rohrleitung DN150",auftraggeber:"Kraftwerk S√ºd AG",werkstoff:"1.4571",bewertungsgruppe:"B",status:"Bestanden",zugfestigkeit:"545"},{id:"3",auftragsnummer:"WPS-2024-008",pruefgegenstand:"WPS-Qualifizierung MAG",auftraggeber:"Stahlbau Huber",werkstoff:"S460",bewertungsgruppe:"B",status:"Nacharbeit",haerteMax:"465",zugfestigkeit:"580"}]);
  const[geb,setGeb]=useState({aktenstudium:1.5,ortsaugenschein:2,recherche:2,berechnung:1.5,gutachten:5,korrektur:1,satz:180,fahrzeit:1,km:40,pruefmittel:45,kopien:15,druck:25,labor:0});
  
  useEffect(()=>{
    fetch('/api/health')
      .then(r=>r.json())
      .then(d=>setApiStatus({anthropic:d.anthropic||false,notion:d.notion||false,cloudinary:d.cloudinary||false}))
      .catch(()=>setApiStatus({anthropic:false,notion:false,cloudinary:false}));
  },[]);
  
  const werkstoffe=["S235","S275","S355","S355J2+N","S460","S690","1.4301","1.4571","1.4462"];
  
  const handleImageSelect=(e)=>{
    const files=Array.from(e.target.files);
    if(files.length>0){
      const newFiles=[...selectedImages,...files].slice(0,4);
      setSelectedImages(newFiles);
      setImagePreviews(newFiles.map(f=>URL.createObjectURL(f)));
      setAnalysisResult(null);
      setSaveResult(null);
    }
  };
  
  const removeImage=(i)=>{
    setSelectedImages(p=>p.filter((_,idx)=>idx!==i));
    setImagePreviews(p=>p.filter((_,idx)=>idx!==i));
  };
  
  const resetAnalysis=()=>{
    setSelectedImages([]);
    setImagePreviews([]);
    setAnalysisResult(null);
    setSaveResult(null);
    if(fileInputRef.current)fileInputRef.current.value='';
  };
  
  const analyzeImages=async()=>{
    if(selectedImages.length===0)return;
    setAnalyzing(true);
    setSaveResult(null);
    try{
      const formData=new FormData();
      selectedImages.forEach(img=>formData.append('images',img));
      formData.append('werkstoff',protokoll.werkstoff);
      formData.append('bewertungsgruppe',protokoll.bewertungsgruppe);
      formData.append('wanddicke',protokoll.wanddicke);
      
      const response=await fetch('/api/analyze',{method:'POST',body:formData});
      const data=await response.json();
      
      if(data.success){
        setAnalysisResult(data.analysis);
        setProtokoll(p=>({...p,
          vtErgebnis:data.analysis.vtErgebnis,
          anamnese:data.analysis.anamnese,
          diagnose:data.analysis.diagnose,
          conclusio:data.analysis.conclusio,
          status:data.analysis.status
        }));
      }else{
        alert('Analyse fehlgeschlagen: '+data.error);
      }
    }catch(error){
      alert('Fehler: '+error.message);
    }
    setAnalyzing(false);
  };
  
  // NEU: In Notion speichern mit ALLEN Bildern
  const saveToNotion=async()=>{
    if(!analysisResult){
      alert('Bitte zuerst eine Analyse durchf√ºhren');
      return;
    }
    setSaving(true);
    setSaveResult(null);
    
    try{
      // 1. Alle Bilder zu Cloudinary hochladen
      const uploadFormData=new FormData();
      selectedImages.forEach(img=>uploadFormData.append('images',img));
      
      const uploadResponse=await fetch('/api/upload-images',{method:'POST',body:uploadFormData});
      const uploadData=await uploadResponse.json();
      
      if(!uploadData.success){
        throw new Error('Bild-Upload fehlgeschlagen: '+uploadData.error);
      }
      
      // 2. Gutachten mit ALLEN Foto-URLs in Notion speichern
      const gutachtenData={
        auftragsnummer:protokoll.auftragsnummer||`GA-${Date.now()}`,
        pruefgegenstand:protokoll.pruefgegenstand,
        auftraggeber:protokoll.auftraggeber,
        werkstoff:protokoll.werkstoff,
        bewertungsgruppe:protokoll.bewertungsgruppe,
        wanddicke:protokoll.wanddicke,
        anamnese:analysisResult.anamnese,
        diagnose:analysisResult.diagnose,
        conclusio:analysisResult.conclusio,
        status:analysisResult.status,
        fotoUrls:uploadData.imageUrls // ALLE Bilder!
      };
      
      const saveResponse=await fetch('/api/save-gutachten',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(gutachtenData)
      });
      const saveData=await saveResponse.json();
      
      if(saveData.success){
        setSaveResult({success:true,url:saveData.url,imageCount:uploadData.imageUrls.length});
      }else{
        throw new Error(saveData.error||'Speichern fehlgeschlagen');
      }
    }catch(error){
      setSaveResult({success:false,error:error.message});
    }
    setSaving(false);
  };
  
  const muehe=(geb.aktenstudium+geb.ortsaugenschein+geb.recherche+geb.berechnung+geb.gutachten+geb.korrektur)*geb.satz;
  const zeit=geb.fahrzeit*22.7,reise=geb.km*0.42,bar=geb.pruefmittel+geb.kopien+geb.druck+geb.labor;
  const netto=muehe+zeit+reise+bar,gesamt=netto*1.2;
  
  const getStatusClass=(s)=>{
    switch(s?.toLowerCase()){
      case'bestanden':return'status-bestanden';
      case'nacharbeit':return'status-nacharbeit';
      case'nicht bestanden':return'status-nichtbestanden';
      default:return'glass';
    }
  };
  
  return(
    <div style={{minHeight:"100vh"}}>
      {/* Premium Header */}
      <header style={{background:"rgba(0,0,0,0.4)",backdropFilter:"blur(20px)",padding:"16px 24px",borderBottom:"1px solid rgba(249,115,22,0.3)"}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",maxWidth:"1400px",margin:"0 auto"}}>
          <div style={{display:"flex",alignItems:"center",gap:"16px"}}>
            <div className="animate-float" style={{background:"linear-gradient(135deg,#f97316,#ea580c)",padding:"14px",borderRadius:"16px",boxShadow:"0 8px 32px rgba(249,115,22,0.4)"}}>
              <span style={{fontSize:"32px"}}>üî•</span>
            </div>
            <div>
              <h1 style={{color:"#fff",fontSize:"22px",fontWeight:700,margin:0,letterSpacing:"-0.5px"}}>SV Gutachten Schwei√ütechnik</h1>
              <p style={{color:"#f97316",fontSize:"12px",margin:"4px 0 0",fontWeight:500}}>v10.1 Premium Edition ¬∑ Claude Vision ¬∑ ISO 15614-1</p>
            </div>
          </div>
          <div style={{display:"flex",gap:"12px",alignItems:"center"}}>
            {[
              {label:"Claude Vision",active:apiStatus.anthropic},
              {label:"Notion",active:apiStatus.notion},
              {label:"Cloudinary",active:apiStatus.cloudinary}
            ].map((s,i)=>(
              <span key={i} style={{background:s.active?"rgba(34,197,94,0.15)":"rgba(239,68,68,0.15)",border:"1px solid "+(s.active?"rgba(34,197,94,0.5)":"rgba(239,68,68,0.5)"),color:s.active?"#4ade80":"#f87171",padding:"6px 12px",borderRadius:"8px",fontSize:"11px",fontWeight:500}}>
                {s.label}: {s.active?"‚úì":"‚úó"}
              </span>
            ))}
          </div>
        </div>
      </header>
      
      {/* Navigation */}
      <nav style={{background:"rgba(0,0,0,0.3)",backdropFilter:"blur(10px)",borderBottom:"1px solid rgba(255,255,255,0.1)"}}>
        <div style={{display:"flex",maxWidth:"1400px",margin:"0 auto"}}>
          {[
            {id:'analyse',label:'üîç KI-Analyse',icon:'üîç'},
            {id:'protokoll',label:'üìã Pr√ºfprotokoll',icon:'üìã'},
            {id:'auftraege',label:'üìä Auftr√§ge',icon:'üìä'},
            {id:'gebuehren',label:'üí∞ Geb√ºhren',icon:'üí∞'},
            {id:'katalog',label:'üìñ Fehlerkatalog',icon:'üìñ'}
          ].map(tab=>(
            <button key={tab.id} onClick={()=>setActiveTab(tab.id)} style={{
              padding:"16px 28px",
              background:activeTab===tab.id?"rgba(249,115,22,0.2)":"transparent",
              color:activeTab===tab.id?"#f97316":"rgba(255,255,255,0.6)",
              border:"none",
              borderBottom:activeTab===tab.id?"2px solid #f97316":"2px solid transparent",
              fontSize:"14px",
              fontWeight:600,
              cursor:"pointer",
              transition:"all 0.3s ease"
            }}>{tab.label}</button>
          ))}
        </div>
      </nav>
      
      {/* Main Content */}
      <main style={{padding:"32px 24px",maxWidth:"1400px",margin:"0 auto"}}>
        
        {/* ANALYSE TAB */}
        {activeTab==='analyse'&&(
          <div className="grid-2 animate-slide">
            {/* Left Column - Upload & Settings */}
            <div>
              {/* Image Upload Card */}
              <div className="glass" style={{padding:"28px",marginBottom:"24px"}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"}}>
                  <h3 style={{margin:0,fontSize:"18px",fontWeight:600}}>üì∑ Schwei√ünaht-Fotos (bis zu 4)</h3>
                  {(selectedImages.length>0||analysisResult)&&(
                    <button onClick={resetAnalysis} style={{padding:"8px 16px",background:"rgba(239,68,68,0.2)",color:"#f87171",border:"1px solid rgba(239,68,68,0.5)",borderRadius:"8px",fontSize:"13px",fontWeight:500,cursor:"pointer"}}>
                      üîÑ Neu starten
                    </button>
                  )}
                </div>
                
                <input type="file" ref={fileInputRef} accept="image/*" multiple onChange={handleImageSelect} style={{display:"none"}}/>
                
                {imagePreviews.length>0&&(
                  <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginBottom:"20px"}}>
                    {imagePreviews.map((p,i)=>(
                      <div key={i} style={{position:"relative",borderRadius:"12px",overflow:"hidden",border:"2px solid rgba(255,255,255,0.1)"}}>
                        <img src={p} alt={"Foto "+(i+1)} style={{width:"100%",height:"140px",objectFit:"cover"}}/>
                        <button onClick={()=>removeImage(i)} style={{position:"absolute",top:"8px",right:"8px",background:"rgba(239,68,68,0.9)",color:"#fff",border:"none",borderRadius:"50%",width:"28px",height:"28px",cursor:"pointer",fontWeight:"bold"}}>‚úï</button>
                        <span style={{position:"absolute",bottom:"8px",left:"8px",background:"rgba(0,0,0,0.7)",color:"#fff",padding:"4px 10px",borderRadius:"6px",fontSize:"11px",fontWeight:500}}>
                          {["Draufsicht","Wurzelseite","Seitenansicht","Detail"][i]}
                        </span>
                      </div>
                    ))}
                  </div>
                )}
                
                {selectedImages.length<4&&(
                  <div onClick={()=>fileInputRef.current?.click()} style={{
                    border:"2px dashed rgba(249,115,22,0.4)",
                    borderRadius:"16px",
                    padding:selectedImages.length>0?"24px":"48px",
                    textAlign:"center",
                    cursor:"pointer",
                    background:"rgba(249,115,22,0.05)",
                    transition:"all 0.3s ease"
                  }}>
                    <span style={{fontSize:selectedImages.length>0?"36px":"56px"}}>üì∑</span>
                    <p style={{color:"rgba(255,255,255,0.7)",marginTop:"12px",marginBottom:0,fontWeight:500}}>
                      {selectedImages.length===0?"Fotos hier hochladen":"+ Weitere Fotos ("+(4-selectedImages.length)+" √ºbrig)"}
                    </p>
                  </div>
                )}
                
                <button onClick={analyzeImages} disabled={selectedImages.length===0||analyzing} className="btn-premium" style={{
                  width:"100%",
                  marginTop:"20px",
                  padding:"16px",
                  borderRadius:"12px",
                  fontSize:"16px"
                }}>
                  {analyzing?(<><span className="loading"></span> Claude analysiert...</>):(`ü§ñ ${selectedImages.length} Foto(s) analysieren`)}
                </button>
              </div>
              
              {/* Werkstoff Settings Card */}
              <div className="glass" style={{padding:"28px"}}>
                <h3 style={{margin:"0 0 20px",fontSize:"18px",fontWeight:600}}>‚öôÔ∏è Werkstoffdaten</h3>
                
                <div style={{marginBottom:"20px"}}>
                  <label style={{fontSize:"13px",color:"rgba(255,255,255,0.7)",display:"block",marginBottom:"8px",fontWeight:500}}>Werkstoff</label>
                  <select value={protokoll.werkstoff} onChange={(e)=>setProtokoll({...protokoll,werkstoff:e.target.value})} style={{width:"100%"}}>
                    {werkstoffe.map(w=>(<option key={w} value={w}>{w} (Gruppe {getWerkstoffgruppe(w)})</option>))}
                  </select>
                </div>
                
                {protokoll.werkstoff&&(
                  <div style={{background:"rgba(59,130,246,0.1)",border:"1px solid rgba(59,130,246,0.3)",borderRadius:"12px",padding:"16px",marginBottom:"20px"}}>
                    <p style={{fontSize:"13px",color:"#60a5fa",margin:"0 0 12px",fontWeight:600}}>üìã Grenzwerte (Gruppe {getWerkstoffgruppe(protokoll.werkstoff)}):</p>
                    <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",fontSize:"12px"}}>
                      <div style={{color:"rgba(255,255,255,0.8)"}}>
                        <strong>H√§rte max:</strong><br/>{GRENZWERTE.haerte[getWerkstoffgruppe(protokoll.werkstoff)]?.max||"kein Limit"} HV10
                      </div>
                      <div style={{color:"rgba(255,255,255,0.8)"}}>
                        <strong>Zugfestigkeit min:</strong><br/>{GRENZWERTE.zugfestigkeit[protokoll.werkstoff.split(" ")[0]]?.min||"n.a."} N/mm¬≤
                      </div>
                    </div>
                  </div>
                )}
                
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"}}>
                  <div>
                    <label style={{fontSize:"13px",color:"rgba(255,255,255,0.7)",display:"block",marginBottom:"8px",fontWeight:500}}>Wanddicke (mm)</label>
                    <input type="number" value={protokoll.wanddicke} onChange={(e)=>setProtokoll({...protokoll,wanddicke:e.target.value})} placeholder="z.B. 12" style={{width:"100%"}}/>
                  </div>
                  <div>
                    <label style={{fontSize:"13px",color:"rgba(255,255,255,0.7)",display:"block",marginBottom:"8px",fontWeight:500}}>Bewertungsgruppe</label>
                    <div style={{display:"flex",gap:"8px"}}>
                      {["B","C","D"].map(g=>(
                        <button key={g} onClick={()=>setProtokoll({...protokoll,bewertungsgruppe:g})} style={{
                          flex:1,
                          padding:"10px",
                          borderRadius:"8px",
                          fontWeight:600,
                          background:protokoll.bewertungsgruppe===g?"linear-gradient(135deg,#f97316,#ea580c)":"rgba(255,255,255,0.08)",
                          color:protokoll.bewertungsgruppe===g?"#fff":"rgba(255,255,255,0.7)",
                          border:protokoll.bewertungsgruppe===g?"none":"1px solid rgba(255,255,255,0.15)",
                          cursor:"pointer"
                        }}>{g}</button>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            {/* Right Column - Results */}
            <div className="glass" style={{padding:"28px"}}>
              <h3 style={{margin:"0 0 24px",fontSize:"18px",fontWeight:600}}>üìã KI-Analyse-Ergebnis</h3>
              
              {analysisResult?(
                <>
                  {/* Status Badge */}
                  <div className={getStatusClass(analysisResult.status)+" animate-glow"} style={{
                    borderRadius:"16px",
                    padding:"20px",
                    marginBottom:"24px",
                    textAlign:"center"
                  }}>
                    <span style={{fontSize:"24px",fontWeight:700}}>
                      {analysisResult.status==='Bestanden'?'‚úì BESTANDEN':analysisResult.status==='Nacharbeit'?'‚ö† NACHARBEIT':'‚úó NICHT BESTANDEN'}
                    </span>
                  </div>
                  
                  {/* Analysis Sections */}
                  {[
                    {title:'ANAMNESE',content:analysisResult.anamnese,color:'#3b82f6',icon:'üîç'},
                    {title:'DIAGNOSE',content:analysisResult.diagnose,color:'#f97316',icon:'‚öñÔ∏è'},
                    {title:'CONCLUSIO',content:analysisResult.conclusio,color:'#22c55e',icon:'üìã'}
                  ].map((s,i)=>(
                    <div key={i} style={{marginBottom:"20px"}}>
                      <h4 style={{fontSize:"13px",color:s.color,margin:"0 0 10px",fontWeight:600}}>{s.icon} {s.title}</h4>
                      <div style={{
                        fontSize:"12px",
                        lineHeight:"1.6",
                        whiteSpace:"pre-wrap",
                        background:"rgba(0,0,0,0.3)",
                        padding:"16px",
                        borderRadius:"10px",
                        borderLeft:"3px solid "+s.color,
                        maxHeight:"180px",
                        overflowY:"auto",
                        color:"rgba(255,255,255,0.85)"
                      }}>{s.content||'Keine Daten'}</div>
                    </div>
                  ))}
                  
                  {/* Fehler-Tags */}
                  {analysisResult.erkannteFehlercodes?.length>0&&(
                    <div style={{marginBottom:"24px"}}>
                      <h4 style={{fontSize:"13px",color:"#ef4444",margin:"0 0 12px",fontWeight:600}}>‚ö†Ô∏è Erkannte Fehler (ISO 6520-1):</h4>
                      <div style={{display:"flex",flexWrap:"wrap",gap:"8px"}}>
                        {analysisResult.erkannteFehlercodes.map((f,i)=>(
                          <span key={i} style={{
                            background:f.kritisch?"rgba(239,68,68,0.2)":"rgba(255,255,255,0.08)",
                            border:"1px solid "+(f.kritisch?"rgba(239,68,68,0.5)":"rgba(255,255,255,0.2)"),
                            padding:"6px 12px",
                            borderRadius:"8px",
                            fontSize:"12px",
                            color:f.kritisch?"#f87171":"rgba(255,255,255,0.8)"
                          }}>
                            <strong>{f.code}</strong> {f.name}
                          </span>
                        ))}
                      </div>
                    </div>
                  )}
                  
                  {/* Action Buttons */}
                  <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginTop:"24px"}}>
                    <button onClick={saveToNotion} disabled={saving} className="btn-premium btn-notion" style={{
                      padding:"14px",
                      borderRadius:"10px",
                      fontSize:"14px",
                      fontWeight:600,
                      cursor:saving?"not-allowed":"pointer"
                    }}>
                      {saving?(<><span className="loading"></span> Speichern...</>):"üíæ In Notion speichern"}
                    </button>
                    <button onClick={()=>generateGutachtenDOCX({...protokoll,...analysisResult})} className="btn-premium" style={{
                      padding:"14px",
                      borderRadius:"10px",
                      fontSize:"14px"
                    }}>üìÑ DOCX Export</button>
                  </div>
                  
                  {/* Save Result */}
                  {saveResult&&(
                    <div style={{
                      marginTop:"16px",
                      padding:"16px",
                      borderRadius:"10px",
                      background:saveResult.success?"rgba(34,197,94,0.15)":"rgba(239,68,68,0.15)",
                      border:"1px solid "+(saveResult.success?"rgba(34,197,94,0.5)":"rgba(239,68,68,0.5)")
                    }}>
                      {saveResult.success?(
                        <div>
                          <p style={{margin:"0 0 8px",color:"#4ade80",fontWeight:600}}>‚úì Erfolgreich in Notion gespeichert!</p>
                          <p style={{margin:0,fontSize:"12px",color:"rgba(255,255,255,0.7)"}}>
                            {saveResult.imageCount} Foto(s) hochgeladen
                          </p>
                          {saveResult.url&&(
                            <a href={saveResult.url} target="_blank" rel="noopener noreferrer" style={{
                              display:"inline-block",
                              marginTop:"12px",
                              padding:"8px 16px",
                              background:"rgba(0,0,0,0.3)",
                              color:"#fff",
                              borderRadius:"6px",
                              fontSize:"12px",
                              textDecoration:"none"
                            }}>üîó In Notion √∂ffnen ‚Üí</a>
                          )}
                        </div>
                      ):(
                        <p style={{margin:0,color:"#f87171"}}>‚úó Fehler: {saveResult.error}</p>
                      )}
                    </div>
                  )}
                </>
              ):(
                <div style={{textAlign:"center",padding:"80px 20px",color:"rgba(255,255,255,0.5)"}}>
                  <span style={{fontSize:"80px",opacity:0.3}}>ü§ñ</span>
                  <p style={{marginTop:"24px",fontSize:"16px",fontWeight:500}}>Lade Schwei√ünaht-Fotos hoch</p>
                  <p style={{fontSize:"13px",marginTop:"8px"}}>Claude Vision analysiert nach ISO 5817</p>
                </div>
              )}
            </div>
          </div>
        )}
        
        {/* PROTOKOLL TAB */}
        {activeTab==='protokoll'&&(
          <div className="grid-2 animate-slide">
            <div className="glass" style={{padding:"28px"}}>
              <h3 style={{margin:"0 0 24px",fontSize:"18px",fontWeight:600}}>üìã Auftragsdaten</h3>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"}}>
                {[
                  ["Auftragsnummer","auftragsnummer","PA-2024-XXXX"],
                  ["Pr√ºfgegenstand","pruefgegenstand","z.B. Druckbeh√§lter"],
                  ["Auftraggeber","auftraggeber","Firma"],
                  ["Wanddicke (mm)","wanddicke","12"]
                ].map(([label,field,ph])=>(
                  <div key={field}>
                    <label style={{fontSize:"13px",color:"rgba(255,255,255,0.7)",display:"block",marginBottom:"8px",fontWeight:500}}>{label}</label>
                    <input type="text" value={protokoll[field]||""} onChange={(e)=>setProtokoll({...protokoll,[field]:e.target.value})} placeholder={ph} style={{width:"100%"}}/>
                  </div>
                ))}
              </div>
            </div>
            <div className="glass" style={{padding:"28px"}}>
              <h3 style={{margin:"0 0 24px",fontSize:"18px",fontWeight:600}}>‚öôÔ∏è Mechanische Pr√ºfungen</h3>
              
              {/* H√§rtepr√ºfung */}
              <div style={{marginBottom:"20px",padding:"16px",background:"rgba(0,0,0,0.2)",borderRadius:"12px"}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}}>
                  <span style={{fontSize:"14px",fontWeight:600}}>H√§rtepr√ºfung (ISO 9015-1)</span>
                  {protokoll.haerteMax&&(
                    <span style={{fontSize:"12px",padding:"6px 12px",borderRadius:"6px",background:bewerteHaerte(protokoll.werkstoff,protokoll.haerteMax).status==="bestanden"?"rgba(34,197,94,0.2)":"rgba(239,68,68,0.2)",color:bewerteHaerte(protokoll.werkstoff,protokoll.haerteMax).status==="bestanden"?"#4ade80":"#f87171"}}>
                      {bewerteHaerte(protokoll.werkstoff,protokoll.haerteMax).text}
                    </span>
                  )}
                </div>
                <div style={{display:"flex",gap:"12px",alignItems:"center"}}>
                  <input type="number" placeholder="Max. H√§rtewert" value={protokoll.haerteMax} onChange={(e)=>setProtokoll({...protokoll,haerteMax:e.target.value})} style={{flex:1}}/>
                  <span style={{fontSize:"13px",color:"rgba(255,255,255,0.6)"}}>HV10</span>
                </div>
              </div>
              
              {/* Zugversuch */}
              <div style={{marginBottom:"20px",padding:"16px",background:"rgba(0,0,0,0.2)",borderRadius:"12px"}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}}>
                  <span style={{fontSize:"14px",fontWeight:600}}>Zugversuch (ISO 4136)</span>
                  {protokoll.zugfestigkeit&&(
                    <span style={{fontSize:"12px",padding:"6px 12px",borderRadius:"6px",background:bewerteZugversuch(protokoll.werkstoff,protokoll.zugfestigkeit).status==="bestanden"?"rgba(34,197,94,0.2)":"rgba(239,68,68,0.2)",color:bewerteZugversuch(protokoll.werkstoff,protokoll.zugfestigkeit).status==="bestanden"?"#4ade80":"#f87171"}}>
                      {bewerteZugversuch(protokoll.werkstoff,protokoll.zugfestigkeit).text}
                    </span>
                  )}
                </div>
                <div style={{display:"flex",gap:"12px",alignItems:"center"}}>
                  <input type="number" placeholder="Rm" value={protokoll.zugfestigkeit} onChange={(e)=>setProtokoll({...protokoll,zugfestigkeit:e.target.value})} style={{flex:1}}/>
                  <span style={{fontSize:"13px",color:"rgba(255,255,255,0.6)"}}>N/mm¬≤</span>
                </div>
              </div>
              
              {/* Biegeversuch */}
              <div style={{padding:"16px",background:"rgba(0,0,0,0.2)",borderRadius:"12px"}}>
                <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"}}>
                  <span style={{fontSize:"14px",fontWeight:600}}>Biegeversuch (ISO 5173)</span>
                  {(protokoll.biegewinkel||protokoll.risslaenge)&&(
                    <span style={{fontSize:"12px",padding:"6px 12px",borderRadius:"6px",background:bewerteBiegeversuch(protokoll.biegewinkel,protokoll.risslaenge).status==="bestanden"?"rgba(34,197,94,0.2)":"rgba(239,68,68,0.2)",color:bewerteBiegeversuch(protokoll.biegewinkel,protokoll.risslaenge).status==="bestanden"?"#4ade80":"#f87171"}}>
                      {bewerteBiegeversuch(protokoll.biegewinkel,protokoll.risslaenge).text}
                    </span>
                  )}
                </div>
                <div style={{display:"flex",gap:"12px",alignItems:"center"}}>
                  <input type="number" placeholder="Winkel" value={protokoll.biegewinkel} onChange={(e)=>setProtokoll({...protokoll,biegewinkel:e.target.value})} style={{width:"100px"}}/>
                  <span style={{fontSize:"13px",color:"rgba(255,255,255,0.6)"}}>¬∞</span>
                  <input type="number" placeholder="Rissl√§nge" value={protokoll.risslaenge} onChange={(e)=>setProtokoll({...protokoll,risslaenge:e.target.value})} style={{width:"100px"}}/>
                  <span style={{fontSize:"13px",color:"rgba(255,255,255,0.6)"}}>mm</span>
                </div>
              </div>
            </div>
          </div>
        )}
        
        {/* AUFTR√ÑGE TAB */}
        {activeTab==='auftraege'&&(
          <div className="animate-slide">
            <div className="grid-4" style={{marginBottom:"32px"}}>
              {[
                {label:"Gesamt",value:auftraege.length,color:"#3b82f6",icon:"üìã"},
                {label:"Bestanden",value:auftraege.filter(a=>a.status==="Bestanden").length,color:"#22c55e",icon:"‚úì"},
                {label:"Nacharbeit",value:auftraege.filter(a=>a.status==="Nacharbeit").length,color:"#f59e0b",icon:"‚ö†"},
                {label:"Nicht best.",value:auftraege.filter(a=>a.status==="Nicht bestanden").length,color:"#ef4444",icon:"‚úó"}
              ].map((s,i)=>(
                <div key={i} className="glass" style={{padding:"24px",borderLeft:"4px solid "+s.color}}>
                  <p style={{fontSize:"13px",color:"rgba(255,255,255,0.6)",margin:0}}>{s.label}</p>
                  <p style={{fontSize:"32px",fontWeight:700,margin:"12px 0 0",color:s.color}}>{s.icon} {s.value}</p>
                </div>
              ))}
            </div>
            
            <div className="glass" style={{padding:"28px"}}>
              <h3 style={{margin:"0 0 24px",fontSize:"18px",fontWeight:600}}>üìä Pr√ºfauftr√§ge</h3>
              {auftraege.map(a=>(
                <div key={a.id} className={getStatusClass(a.status)} style={{borderRadius:"14px",padding:"24px",marginBottom:"16px"}}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"16px"}}>
                    <div>
                      <span style={{background:"rgba(255,255,255,0.15)",padding:"6px 14px",borderRadius:"8px",fontSize:"12px",fontWeight:600}}>{a.auftragsnummer}</span>
                      <h4 style={{margin:"12px 0 6px",fontSize:"18px",fontWeight:600}}>{a.pruefgegenstand}</h4>
                      <p style={{fontSize:"14px",color:"rgba(255,255,255,0.7)",margin:0}}>{a.auftraggeber}</p>
                    </div>
                    <span style={{fontSize:"32px",fontWeight:700}}>{a.status==="Bestanden"?"‚úì":a.status==="Nicht bestanden"?"‚úó":"‚ö†"}</span>
                  </div>
                  <div style={{display:"flex",gap:"20px",flexWrap:"wrap",fontSize:"13px",color:"rgba(255,255,255,0.8)"}}>
                    <span>üîß {a.werkstoff}</span>
                    <span>üìä ISO 5817 {a.bewertungsgruppe}</span>
                    {a.haerteMax&&<span>üî® {a.haerteMax} HV10</span>}
                    {a.zugfestigkeit&&<span>üìè {a.zugfestigkeit} N/mm¬≤</span>}
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}
        
        {/* GEB√úHREN TAB */}
        {activeTab==='gebuehren'&&(
          <div className="grid-2 animate-slide">
            <div>
              <div className="glass" style={{padding:"28px",marginBottom:"24px"}}>
                <h3 style={{margin:"0 0 24px",fontSize:"18px",fontWeight:600}}>‚è±Ô∏è Zeitaufwand</h3>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"}}>
                  {[["Aktenstudium","aktenstudium"],["Ortsaugenschein","ortsaugenschein"],["Recherche","recherche"],["Berechnung","berechnung"],["Gutachten","gutachten"],["Korrektur","korrektur"]].map(([l,f])=>(
                    <div key={f} style={{display:"flex",alignItems:"center",gap:"12px"}}>
                      <span style={{fontSize:"13px",flex:1,color:"rgba(255,255,255,0.8)"}}>{l}</span>
                      <input type="number" step="0.5" value={geb[f]} onChange={(e)=>setGeb({...geb,[f]:parseFloat(e.target.value)||0})} style={{width:"70px",textAlign:"right"}}/>
                      <span style={{fontSize:"12px",color:"rgba(255,255,255,0.5)",width:"20px"}}>h</span>
                    </div>
                  ))}
                </div>
                <div style={{marginTop:"20px",padding:"16px",background:"rgba(0,0,0,0.2)",borderRadius:"10px"}}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                    <span style={{fontWeight:600}}>Stundensatz</span>
                    <div style={{display:"flex",alignItems:"center",gap:"8px"}}>
                      <input type="number" value={geb.satz} onChange={(e)=>setGeb({...geb,satz:parseFloat(e.target.value)||0})} style={{width:"90px",textAlign:"right"}}/>
                      <span style={{color:"rgba(255,255,255,0.6)"}}>‚Ç¨/h</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <div className="glass" style={{padding:"28px"}}>
                <h3 style={{margin:"0 0 24px",fontSize:"18px",fontWeight:600}}>üöó Reisekosten</h3>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"}}>
                  {[["Fahrzeit","fahrzeit","h","√ó22,70‚Ç¨"],["Kilometer","km","km","√ó0,42‚Ç¨"],["Pr√ºfmittel","pruefmittel","‚Ç¨",""],["Kopien","kopien","‚Ç¨",""],["Druck","druck","‚Ç¨",""],["Labor","labor","‚Ç¨",""]].map(([l,f,u,m])=>(
                    <div key={f} style={{display:"flex",alignItems:"center",gap:"8px"}}>
                      <span style={{fontSize:"13px",flex:1,color:"rgba(255,255,255,0.8)"}}>{l}</span>
                      <input type="number" step={u==="h"?"0.5":"1"} value={geb[f]} onChange={(e)=>setGeb({...geb,[f]:parseFloat(e.target.value)||0})} style={{width:"70px",textAlign:"right"}}/>
                      <span style={{fontSize:"11px",color:"rgba(255,255,255,0.5)",width:"60px"}}>{u} {m}</span>
                    </div>
                  ))}
                </div>
              </div>
            </div>
            
            <div className="glass-dark" style={{padding:"32px",background:"linear-gradient(180deg,rgba(249,115,22,0.1) 0%,rgba(0,0,0,0.4) 100%)"}}>
              <h3 style={{margin:"0 0 32px",fontSize:"20px",fontWeight:700,color:"#f97316"}}>üí∞ Honorar nach GebAG</h3>
              
              <div style={{marginBottom:"32px"}}>
                {[
                  ["M√ºhewaltung",(geb.aktenstudium+geb.ortsaugenschein+geb.recherche+geb.berechnung+geb.gutachten+geb.korrektur).toFixed(1)+"h √ó "+geb.satz+"‚Ç¨",muehe],
                  ["Zeitvers√§umnis",geb.fahrzeit+"h √ó 22,70‚Ç¨",zeit],
                  ["Reisekosten",geb.km+"km √ó 0,42‚Ç¨",reise],
                  ["Barauslagen","Pr√ºfmittel etc.",bar]
                ].map(([l,d,v])=>(
                  <div key={l} style={{display:"flex",justifyContent:"space-between",padding:"16px 0",borderBottom:"1px solid rgba(255,255,255,0.1)"}}>
                    <div>
                      <p style={{margin:0,fontWeight:600,fontSize:"15px"}}>{l}</p>
                      <p style={{margin:"6px 0 0",fontSize:"12px",color:"rgba(255,255,255,0.5)"}}>{d}</p>
                    </div>
                    <span style={{fontWeight:700,fontSize:"18px",color:"#fff"}}>‚Ç¨ {v.toFixed(2)}</span>
                  </div>
                ))}
              </div>
              
              <div style={{padding:"20px",background:"rgba(249,115,22,0.15)",borderRadius:"12px",marginBottom:"20px",border:"1px solid rgba(249,115,22,0.3)"}}>
                <div style={{display:"flex",justifyContent:"space-between",marginBottom:"12px"}}>
                  <span style={{color:"rgba(255,255,255,0.8)"}}>Netto</span>
                  <span style={{fontWeight:700,fontSize:"18px"}}>‚Ç¨ {netto.toFixed(2)}</span>
                </div>
                <div style={{display:"flex",justifyContent:"space-between",fontSize:"13px",color:"rgba(255,255,255,0.6)"}}>
                  <span>+ 20% USt</span>
                  <span>‚Ç¨ {(netto*0.2).toFixed(2)}</span>
                </div>
              </div>
              
              <div className="btn-premium animate-glow" style={{padding:"28px",borderRadius:"16px",textAlign:"center"}}>
                <p style={{margin:"0 0 8px",fontSize:"14px",opacity:0.9}}>Gesamt inkl. USt</p>
                <p style={{margin:0,fontSize:"42px",fontWeight:800}}>‚Ç¨ {gesamt.toFixed(2)}</p>
              </div>
              
              <p style={{fontSize:"11px",color:"rgba(255,255,255,0.4)",marginTop:"20px",textAlign:"center"}}>GebAG ¬ß34, ¬ß35, ¬ß36 ¬∑ Gerichtssachverst√§ndigengeb√ºhren</p>
            </div>
          </div>
        )}
        
        {/* KATALOG TAB */}
        {activeTab==='katalog'&&(
          <div className="animate-slide">
            <div className="glass" style={{padding:"28px"}}>
              <h3 style={{margin:"0 0 28px",fontSize:"20px",fontWeight:700}}>üìñ Fehlerkatalog ISO 6520-1</h3>
              <div className="grid-3">
                {Object.entries(FEHLERKATALOG).map(([code,f])=>(
                  <div key={code} className="glass" style={{
                    padding:"20px",
                    background:f.kritisch?"rgba(239,68,68,0.1)":"rgba(255,255,255,0.03)",
                    border:f.kritisch?"1px solid rgba(239,68,68,0.4)":"1px solid rgba(255,255,255,0.1)"
                  }}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"start",marginBottom:"12px"}}>
                      <span style={{fontWeight:700,fontSize:"22px",color:f.kritisch?"#f87171":"#fff"}}>{code}</span>
                      {f.kritisch&&(
                        <span style={{background:"rgba(239,68,68,0.3)",color:"#f87171",padding:"4px 10px",borderRadius:"6px",fontSize:"10px",fontWeight:600}}>KRITISCH</span>
                      )}
                    </div>
                    <p style={{fontWeight:600,fontSize:"15px",margin:0,color:"rgba(255,255,255,0.9)"}}>{f.name}</p>
                  </div>
                ))}
              </div>
              
              <div style={{marginTop:"32px",padding:"20px",background:"rgba(59,130,246,0.1)",borderRadius:"12px",border:"1px solid rgba(59,130,246,0.3)"}}>
                <h4 style={{margin:"0 0 12px",fontSize:"15px",color:"#60a5fa",fontWeight:600}}>üìã Referenznormen</h4>
                <div style={{display:"flex",flexWrap:"wrap",gap:"10px",fontSize:"13px"}}>
                  {["ISO 6520-1","ISO 5817","ISO 17637","ISO 15614-1","ISO 9015-1","ISO 4136","ISO 5173"].map((n,i)=>(
                    <span key={i} style={{background:"rgba(255,255,255,0.08)",padding:"8px 14px",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.15)"}}>{n}</span>
                  ))}
                </div>
              </div>
            </div>
          </div>
        )}
      </main>
      
      {/* Footer */}
      <footer style={{padding:"24px 32px",background:"rgba(0,0,0,0.4)",marginTop:"48px",borderTop:"1px solid rgba(249,115,22,0.3)"}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",maxWidth:"1400px",margin:"0 auto"}}>
          <p style={{fontSize:"12px",color:"rgba(255,255,255,0.4)",margin:0}}>
            SV Gutachten v10.1 Premium Edition | Claude Vision | ISO 15614-1, ISO 5817 | ¬© 2025
          </p>
          <div style={{display:"flex",gap:"8px"}}>
            {[
              {label:"Vision",active:apiStatus.anthropic},
              {label:"Notion",active:apiStatus.notion},
              {label:"Cloud",active:apiStatus.cloudinary}
            ].map((s,i)=>(
              <span key={i} style={{
                background:s.active?"rgba(34,197,94,0.15)":"rgba(239,68,68,0.15)",
                padding:"4px 10px",
                borderRadius:"6px",
                fontSize:"10px",
                color:s.active?"#4ade80":"#f87171"
              }}>{s.label}: {s.active?"‚úì":"‚úó"}</span>
            ))}
          </div>
        </div>
      </footer>
    </div>
  );
}

const root=ReactDOM.createRoot(document.getElementById('root'));
root.render(<SchweissGutachterApp/>);
</script>
</body>
</html>
